# Rules for detecting JavaScript technologies

- name: React
  category: Frontend Framework
  version_pattern: 'react[@/-]v?(\d+\.\d+\.\d+[-.\w]*)'
  evidence:
    - type: script_src
      pattern: 'react(\.min)?\.js'
      confidence: 0.7
    - type: js_global
      pattern: '__REACT_DEVTOOLS_GLOBAL_HOOK__|React'
      confidence: 0.9

- name: Angular
  category: Frontend Framework
  version_pattern: 'angular[@/-]v?(\d+\.\d+\.\d+[-.\w]*)'
  evidence:
    - type: script_src
      pattern: 'angular(\.min)?\.js'
      confidence: 0.7
    - type: js_global
      pattern: 'angular'
      confidence: 0.9

- name: Vue.js
  category: Frontend Framework
  version_pattern: 'vue[@/-]v?(\d+\.\d+\.\d+[-.\w]*)'
  evidence:
    - type: script_src
      pattern: 'vue(\.min)?\.js'
      confidence: 0.7
    - type: js_global
      pattern: 'Vue'
      confidence: 0.9

- name: jQuery
  category: JavaScript Library
  version_pattern: 'jquery[/-]v?(\d+\.\d+\.\d+[-.\w]*)'
  evidence:
    - type: js_global
      pattern: 'jQuery|\$'
      confidence: 0.9
    - type: script_src
      pattern: 'jquery.*\.js'
      confidence: 0.9

- name: Lodash
  category: JavaScript Library
  evidence:
    - type: js_global
      pattern: '_'
      confidence: 0.7 # Can be generic
    - type: script_src
      pattern: 'lodash.*\.js'
      confidence: 0.9

- name: Moment.js
  category: JavaScript Library
  evidence:
    - type: js_global
      pattern: 'moment'
      confidence: 0.9
    - type: script_src
      pattern: 'moment.*\.js'
      confidence: 0.9

# Extended JavaScript detections

- name: Google Tag Manager
  category: Analytics
  evidence:
    - type: script_src
      pattern: 'gtm\.js|/gtm\.js'
      confidence: 0.8
    - type: js_global
      pattern: 'dataLayer'
      confidence: 0.7

- name: Google Analytics
  category: Analytics
  evidence:
    - type: script_src
      pattern: 'analytics\.js|gtag/js'
      confidence: 0.8
    - type: js_global
      pattern: 'gtag|ga'
      confidence: 0.7
    - type: script_content_pattern
      pattern: 'gtag\(|ga\(|GoogleAnalyticsObject'
      confidence: 0.8
    - type: inline_js_variable
      pattern: '__gaTracker|_gaq'
      confidence: 0.8

- name: Alpine.js
  category: JavaScript Library
  evidence:
    - type: script_src
      pattern: 'alpine(\.min)?\.js'
      confidence: 0.8
    - type: js_global
      pattern: 'Alpine'
      confidence: 0.8

- name: Preact
  category: Frontend Framework
  evidence:
    - type: script_src
      pattern: 'preact(\.min)?\.js'
      confidence: 0.7
    - type: js_global
      pattern: 'preact|Preact'
      confidence: 0.8

- name: D3.js
  category: JavaScript Library
  evidence:
    - type: script_src
      pattern: 'd3(\.min)?\.js'
      confidence: 0.8
    - type: js_global
      pattern: 'd3'
      confidence: 0.9

- name: Three.js
  category: JavaScript Library
  evidence:
    - type: script_src
      pattern: 'three(\.min)?\.js'
      confidence: 0.8
    - type: js_global
      pattern: 'THREE'
      confidence: 0.9

- name: GSAP
  category: JavaScript Library
  evidence:
    - type: script_src
      pattern: 'gsap(\.min)?\.js'
      confidence: 0.8
    - type: js_global
      pattern: 'gsap'
      confidence: 0.9

- name: Stripe.js
  category: Payments
  evidence:
    - type: script_src
      pattern: 'js\.stripe\.com'
      confidence: 0.9
    - type: js_global
      pattern: 'Stripe'
      confidence: 0.9

# Payment Gateways Extensions

- name: PayPal Checkout
  category: Payments
  evidence:
    - type: script_src
      pattern: 'js\.paypal\.com'
      confidence: 0.9
    - type: js_global
      pattern: 'paypal|PAYPAL'
      confidence: 0.8

- name: Square
  category: Payments
  evidence:
    - type: script_src
      pattern: 'square\.github\.io|paysquare'
      confidence: 0.8
    - type: js_global
      pattern: 'SqPaymentForm'
      confidence: 0.9

- name: Braintree
  category: Payments
  evidence:
    - type: script_src
      pattern: 'braintree'
      confidence: 0.9
    - type: js_global
      pattern: 'braintree'
      confidence: 0.8

# Identity & Auth Providers

- name: Auth0
  category: Identity
  evidence:
    - type: script_src
      pattern: 'cdn\.auth0\.com'
      confidence: 0.9
    - type: js_global
      pattern: 'Auth0|auth0'
      confidence: 0.8

- name: Okta
  category: Identity
  evidence:
    - type: script_src
      pattern: 'okta\.com|oktacdn'
      confidence: 0.9
    - type: js_global
      pattern: 'OktaAuth'
      confidence: 0.8

- name: Firebase Auth
  category: Identity
  evidence:
    - type: script_src
      pattern: 'firebase'
      confidence: 0.7
    - type: js_global
      pattern: 'firebase|FirebaseAuth'
      confidence: 0.8

# Analytics Extensions

- name: Segment
  category: Analytics
  evidence:
    - type: script_src
      pattern: 'cdn\.segment\.com|analytics\.js'
      confidence: 0.9
    - type: js_global
      pattern: 'analytics'
      confidence: 0.7

- name: Mixpanel
  category: Analytics
  evidence:
    - type: script_src
      pattern: 'mixpanel\.com'
      confidence: 0.9
    - type: js_global
      pattern: 'mixpanel'
      confidence: 0.8
    - type: script_content_pattern
      pattern: 'mixpanel\.init|mixpanel\.track'
      confidence: 0.9

- name: Hotjar
  category: Analytics
  evidence:
    - type: script_src
      pattern: 'static\.hotjar\.com'
      confidence: 0.8
    - type: js_global
      pattern: 'hj'
      confidence: 0.6
    - type: script_content_pattern
      pattern: 'hj\(|hjid|hjsv'
      confidence: 0.8

- name: Matomo
  category: Analytics
  evidence:
    - type: script_src
      pattern: 'matomo|piwik'
      confidence: 0.8
    - type: js_global
      pattern: '_paq'
      confidence: 0.8
